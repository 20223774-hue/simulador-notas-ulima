<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Notas ULima</title>

  <style>
    :root{
      --bg:#f3f5fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --shadow:0 16px 40px rgba(15,23,42,.10);
      --shadow2:0 10px 24px rgba(15,23,42,.08);
      --radius:18px;

      --primary:#2563eb;
      --primary2:#1d4ed8;
      --ok:#16a34a;
      --bad:#dc2626;

      --tableHead:#f8fafc;
      --rowA:#ffffff;
      --rowB:#f8fafc;
      --hover:#eef2ff;

      --pillBg:#eef2ff;
      --pillText:#3730a3;
      --focus: rgba(59,130,246,.18);
    }

    html[data-theme="dark"]{
      --bg:#0b1020;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:#223048;
      --shadow:0 16px 40px rgba(0,0,0,.45);
      --shadow2:0 10px 24px rgba(0,0,0,.35);

      --primary:#60a5fa;
      --primary2:#3b82f6;
      --ok:#34d399;
      --bad:#fb7185;

      --tableHead:#0b1220;
      --rowA:#0f172a;
      --rowB:#0b1220;
      --hover:#111c33;

      --pillBg:#111c33;
      --pillText:#c7d2fe;
      --focus: rgba(96,165,250,.18);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      padding:24px;
      color:var(--text);
    }

    .box{
      max-width:1200px;
      margin:auto;
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      border:1px solid var(--border);
      box-shadow:var(--shadow);
    }

    body.inicio-activo{
      padding:0;
    }

    body.inicio-activo .box{
      max-width:none;
      margin:0;
      padding:0;
      background:transparent;
      border:none;
      box-shadow:none;
    }

    body.inicio-activo .inicio{
      min-height:100vh;
      border-radius:0;
    }

    .inicio{
      position:relative;
      min-height: calc(100vh - 48px);
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(circle at top, rgba(255,255,255,.7), rgba(243,245,251,.92)),
        linear-gradient(135deg, rgba(255,255,255,.9), rgba(237,242,250,.95));
      border-radius:24px;
      overflow:hidden;
      border:1px solid var(--border);
      box-shadow:var(--shadow);
    }

    html[data-theme="dark"] .inicio{
      background: radial-gradient(circle at top, rgba(30,41,59,.6), rgba(11,16,32,.95)),
        linear-gradient(135deg, rgba(15,23,42,.95), rgba(2,6,23,.92));
    }

    #mathCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:.8;
    }

    .inicio-content{
      position:relative;
      text-align:center;
      padding:32px 36px;
      border-radius:24px;
      backdrop-filter: blur(18px);
      background: rgba(255,255,255,.7);
      border:1px solid rgba(226,232,240,.8);
      box-shadow: 0 20px 50px rgba(15,23,42,.12);
      max-width:520px;
    }

    html[data-theme="dark"] .inicio-content{
      background: rgba(15,23,42,.75);
      border-color: rgba(51,65,85,.75);
      box-shadow: 0 20px 50px rgba(0,0,0,.45);
    }

    .inicio-title{
      font-size:28px;
      margin:0;
      letter-spacing:.5px;
    }

    .inicio-actions{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
    }

    .btn-start{
      padding:12px 24px;
      border-radius:999px;
      border:1px solid transparent;
      background: linear-gradient(135deg, #0f172a, #334155);
      color:white;
      font-weight:800;
      letter-spacing:.3px;
      box-shadow: 0 16px 30px rgba(15,23,42,.25);
    }

    html[data-theme="dark"] .btn-start{
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      box-shadow: 0 16px 30px rgba(59,130,246,.25);
    }

    .btn-secondary{
      background:transparent;
      border:1px solid var(--border);
      color:var(--text);
      font-weight:800;
      letter-spacing:.3px;
      padding:12px 24px;
      border-radius:999px;
      box-shadow: 0 12px 24px rgba(15,23,42,.12);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
    }

    .topbar-actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-end;
    }

    h2{ margin:0; font-size:22px; }
    .subtitle{ font-size:13px; color:var(--muted); margin-top:6px; line-height:1.35; }
    .creator{ font-size:12px; color:var(--muted); margin-top:4px; }

    .hint{
      margin-top:14px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
    }

    .controls{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--border);
      box-shadow:var(--shadow2);
    }

    label{
      font-size:13px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    input{
      width:120px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      font-weight:600;
    }

    /* iPhone: evita zoom al tocar inputs */
    input, button { font-size:16px; }

    input:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 4px var(--focus);
    }

    button{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--border);
      background:transparent;
      cursor:pointer;
      font-weight:800;
      color:var(--text);
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
    }

    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(0); }

    .btn-primary{
      background:var(--primary);
      border-color:var(--primary);
      color:white;
    }
    .btn-primary:hover{ background:var(--primary2); border-color:var(--primary2); }

    .btn-ghost{ opacity:.85; }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }

    .sim-grid{
      display:grid;
      grid-template-columns: 0.9fr 1.1fr;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }

    .summary-card{
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow2);
    }

    .summary-card h3{
      margin:0 0 10px;
      font-size:16px;
    }

    .mini-table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
    }

    .mini-table th,
    .mini-table td{
      text-align:left;
      padding:6px 8px;
      border-bottom:1px dashed var(--border);
    }

    .tableWrap{
      overflow:auto;
      border-radius:16px;
    }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      margin-top:12px;
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      min-width: 520px; /* ayuda al scroll en m√≥vil */
    }

    th, td{
      padding:10px;
      font-size:13px;
      border-bottom:1px solid var(--border);
      text-align:center;
      white-space:nowrap;
    }

    th{
      background:var(--tableHead);
      font-weight:900;
      position:sticky;
      top:0;
      z-index:1;
    }

    tbody tr:nth-child(odd) td{ background:var(--rowA); }
    tbody tr:nth-child(even) td{ background:var(--rowB); }
    tbody tr:hover td{ background:var(--hover); }

    .ok{ color:var(--ok); font-weight:900; }
    .bad{ color:var(--bad); font-weight:900; }

    .pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      background:var(--pillBg);
      color:var(--pillText);
      font-weight:900;
      white-space:nowrap;
    }

    .course-grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }

    .course-section{
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow2);
      background:var(--card);
    }

    .course-section h3{
      margin:0 0 12px;
      font-size:16px;
    }

    .course-card{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
      background:var(--rowA);
    }

    .course-card h4{
      margin:0 0 10px;
      font-size:14px;
    }

    .course-level-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .level-toggle{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }

    .level-toggle input{
      width:auto;
    }

    .checkbox-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:10px 16px;
    }

    .course-item{
      display:flex;
      gap:12px;
      align-items:flex-start;
      font-size:13px;
      color:var(--text);
      white-space:normal;
    }

    .course-item input{
      width:auto;
      margin-top:3px;
    }

    .course-meta{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }

    .course-meta span{
      font-weight:700;
      line-height:1.5;
      word-break:break-word;
      white-space:normal;
    }

    .course-meta small{
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
      word-break:break-word;
      white-space:normal;
    }

    .course-results{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .course-list{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .course-list li{
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      background:var(--rowA);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .course-list li strong{
      line-height:1.5;
      word-break:break-word;
    }

    .course-tags{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }

    .course-reqs{
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
      word-break:break-word;
    }

    .req-list{
      margin:6px 0 0;
      padding-left:18px;
      display:flex;
      flex-direction:column;
      gap:6px;
      line-height:1.45;
    }

    .req-list li{
      margin:0;
    }

    .course-empty{
      padding:12px;
      border-radius:12px;
      border:1px dashed var(--border);
      color:var(--muted);
      font-size:13px;
    }

    .course-action-group{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .action-tile{
      padding:12px 16px;
      border-radius:14px;
      border:1px solid var(--primary);
      background:var(--primary);
      color:white;
      font-weight:800;
      box-shadow:0 12px 20px rgba(37,99,235,.25);
    }

    .action-tile:hover{
      background:var(--primary2);
      border-color:var(--primary2);
    }

    .schedule-grid{
      display:grid;
      grid-template-columns: 0.9fr 1.1fr;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }

    .schedule-section{
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow2);
      background:var(--card);
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .schedule-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:120px;
    }

    .schedule-item{
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      background:var(--rowA);
      display:flex;
      flex-direction:column;
      gap:6px;
      cursor:grab;
    }

    .schedule-item:active{
      cursor:grabbing;
    }

    .schedule-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .schedule-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .badge-grid{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .badge-card{
      border:1px dashed var(--border);
      border-radius:14px;
      padding:12px;
      background:var(--rowA);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .badge-header{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
    }

    .badge-title{
      flex:1;
      min-width:160px;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      font-weight:700;
      background:transparent;
      color:var(--text);
    }

    .badge-dropzone{
      border:1px dashed var(--border);
      border-radius:12px;
      padding:10px;
      min-height:70px;
      background:var(--tableHead);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .badge-dropzone.drag-over{
      border-color:var(--primary);
      box-shadow:0 0 0 3px var(--focus);
    }

    .badge-course{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:var(--rowA);
      cursor:grab;
    }

    .badge-course button{
      border:none;
      background:transparent;
      font-weight:800;
      color:var(--bad);
      cursor:pointer;
    }

    .badge-empty{
      font-size:12px;
      color:var(--muted);
    }

    /* ‚úÖ Responsive para celular */
    @media (max-width: 900px){
      body{ padding:14px; }
      .box{ padding:14px; }
      .grid,
      .sim-grid,
      .course-grid{ grid-template-columns: 1fr; }
      .inicio{ min-height: calc(100vh - 28px); }
      .inicio-content{ padding:24px; }
      .controls{ gap:8px; }
      label{ width:100%; justify-content:space-between; }
      input{ width:140px; }
      /* botones full width en m√≥vil */
      .controls button{ width:100%; }
      .topbar-actions{ width:100%; align-items:stretch; }
      .topbar-actions button{ width:100%; }
      .course-action-group{ width:100%; }
      .course-action-group button{ width:100%; }
      .schedule-grid{ grid-template-columns: 1fr; }
    }

    /* PDF */
    @media print{
      html[data-theme="dark"]{
        --bg:white; --card:white; --text:#0f172a; --muted:#64748b; --border:#e2e8f0;
        --tableHead:#f8fafc; --rowA:#ffffff; --rowB:#f8fafc; --hover:#eef2ff;
      }
      body{ padding:0; }
      button,.controls{ display:none!important; }
      .box{ box-shadow:none; border:none; }
      input{ border:none; }
    }

    /* -------------------------
       MASCOTA PIXEL (CSS agregado)
       Se solicit√≥ colocar este CSS justo antes del cierre </style>
       ------------------------- */
    #mascota{
      position:fixed;            /* fijo sobre toda la p√°gina */
      width:40px;
      height:40px;
      bottom:120px;              /* valor inicial - se ajusta por JS */
      left:20px;                 /* valor inicial - se ajusta por JS */
      z-index:9999;              /* z-index alto */
      pointer-events:none;       /* NO debe bloquear inputs ni botones */
      transition: transform 220ms linear, left 400ms ease, bottom 220ms ease, opacity 400ms ease;
      will-change: transform, left, opacity;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      color:transparent;
      /* apariencia "pixel" simple con box-shadow */
      background:
        /* cuerpo (2x2 pixels style) */
        linear-gradient(#0f172a 0 0) content-box;
      border-radius:6px;
      box-shadow:
        4px 4px 0 0 #111827,
        -6px 6px 0 0 #1f2937,
        6px -4px 0 0 #334155;
      opacity:0.98;
    }

    /* Dibujo simple para cara/ojos usando pseudo-elementos */
    #mascota::before{
      content:"";
      position:absolute;
      width:28px;
      height:28px;
      background:
        /* eyes and face stylized using linear-gradients */
        linear-gradient(#f3f4f6 0 0) center/100% 100% no-repeat;
      border-radius:4px;
      top:6px;
      left:6px;
      box-shadow: inset -1px -2px 0 0 rgba(0,0,0,0.06);
    }
    #mascota::after{
      content:"";
      position:absolute;
      width:6px;
      height:6px;
      background:#0b1220;
      border-radius:1px;
      top:16px;
      left:13px;
      box-shadow:
        12px 0 0 0 #0b1220,
        4px 8px 0 0 rgba(255,255,255,0.05);
    }

    /* burbuja encima de la mascota */
    #burbuja{
      position:absolute;
      bottom:46px;
      left:50%;
      transform:translateX(-50%) translateY(0);
      min-width:70px;
      max-width:220px;
      padding:6px 8px;
      border-radius:8px;
      background:rgba(255,255,255,0.95);
      color:var(--text);
      font-size:12px;
      font-weight:700;
      text-align:center;
      border:1px solid var(--border);
      box-shadow:0 6px 18px rgba(15,23,42,0.12);
      opacity:0;
      pointer-events:none;
      transition: opacity 180ms ease, transform 180ms ease;
      white-space:nowrap;
      z-index:10000;
    }

    /* dark mode bubble */
    html[data-theme="dark"] #burbuja{
      background: rgba(15,23,42,0.9);
      color:var(--pillText);
      border-color: rgba(51,65,85,0.9);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    }

    /* mostrar burbuja */
    #burbuja.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }

    /* mascota dormida estilo */
    #mascota.dormido{
      opacity:0.55;
      transform:scale(0.98);
      filter:grayscale(.3);
    }

    /* cuando se "sube" a un bot√≥n (se eleva) */
    #mascota.subido{
      transform: translateY(-26px) scale(1.02);
    }

    /* ocultar mascota en impresi√≥n */
    @media print{
      #mascota, #burbuja { display:none !important; }
    }

  </style>
</head>

<body>
<div class="box">

  <section id="vistaInicio">
    <div class="inicio">
      <canvas id="mathCanvas" aria-hidden="true"></canvas>
      <div class="inicio-content">
        <div class="inicio-actions">
          <button class="btn-start" onclick="iniciarSimulador()">Ingresar a simulador de notas</button>
          <button class="btn-secondary" onclick="iniciarSimuladorCursos()">üìò Simulador de cursos</button>
        </div>
      </div>
    </div>
  </section>

  <section id="vistaEntrada" style="display:none;">
    <div class="topbar">
      <div>
        <h2>Simulador de Notas ULima (para no repetir el ciclo)</h2>
        <div class="subtitle">Aprobaci√≥n 10.5 ¬∑ Notas 1‚Äì20 ¬∑ El promedio no perdona</div>
        <div class="creator">Creador: Sebasti√°n Mory Ricse</div>
      </div>
      <div class="topbar-actions">
        <button class="btn-ghost btn-theme" onclick="toggleTheme()">üåô Dark mode</button>
        <button class="btn-secondary" onclick="volverInicio()">Inicia</button>
      </div>
    </div>

    <div class="hint">
      Ingresa tus notas conocidas. Si a√∫n no tienes nota, deja el campo vac√≠o pero indica el porcentaje.
    </div>

    <div class="controls">
      <button onclick="agregarFila()">Agregar fila</button>
      <button onclick="calcular()">Calcular promedio</button>

      <label>Hasta:
        <input id="hastaProm" type="number" min="10.5" max="20" step="0.5" value="20">
      </label>
      <label>Paso:
        <input id="pasoProm" type="number" min="0.5" max="2" step="0.5" value="0.5">
      </label>

      <button class="btn-primary" onclick="correrSimulacion()">Correr simulaci√≥n</button>
      <button onclick="window.print()">Guardar PDF</button>
    </div>

    <div class="grid">
      <div>
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Nota</th>
                <th>%</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tabla"></tbody>
          </table>
        </div>

        <h3>Promedio: <span id="resultado">‚Äî</span></h3>
        <h3 id="estado"></h3>
        <div class="small" id="mensajeExtra"></div>
      </div>
    </div>
  </section>

  <section id="vistaSimulacion" style="display:none;">
    <div class="topbar">
      <div>
        <h2>Simulador de Notas ULima (para no repetir el ciclo)</h2>
        <div class="subtitle">Aprobaci√≥n 10.5 ¬∑ Notas 1‚Äì20 ¬∑ El promedio no perdona</div>
        <div class="creator">Creador: Sebasti√°n Mory Ricse</div>
      </div>
      <div class="topbar-actions">
        <button class="btn-ghost btn-theme" onclick="toggleTheme()">üåô Dark mode</button>
        <button class="btn-secondary" onclick="volverInicio()">Inicia</button>
      </div>
    </div>

    <div class="controls">
      <button onclick="volverEdicion()">‚Üê Volver a editar</button>
      <button class="btn-primary" onclick="correrSimulacion()">Actualizar simulaci√≥n</button>
      <button onclick="window.print()">Guardar PDF</button>
    </div>

    <div class="sim-grid">
      <div class="summary-card">
        <h3>Miniatura de tus datos</h3>
        <table class="mini-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Nota</th>
              <th>%</th>
            </tr>
          </thead>
          <tbody id="miniaturaDatos"></tbody>
        </table>
        <div class="small" id="miniaturaMensaje"></div>
      </div>

      <div>
        <div class="tableWrap">
          <table>
            <thead id="escHead"></thead>
            <tbody id="escenarios"></tbody>
          </table>
        </div>
        <div class="small" style="margin-top:10px;">
          Tip: en celular puedes deslizar la tabla de simulaci√≥n hacia los lados.
        </div>
      </div>
    </div>
  </section>

  <section id="vistaCursos" style="display:none;">
    <div class="topbar">
      <div>
        <h2>Simulador de cursos ULima</h2>
        <div class="subtitle">Marca los cursos que ya aprobaste y descubre los que puedes llevar.</div>
        <div class="creator">Creador: Sebasti√°n Mory Ricse</div>
      </div>
      <div class="topbar-actions">
        <button class="btn-ghost btn-theme" onclick="toggleTheme()">üåô Dark mode</button>
        <button class="btn-secondary" onclick="volverInicio()">Inicia</button>
      </div>
    </div>

    <div class="hint">
      Los cr√©ditos y el nivel de ciclo se calculan autom√°ticamente seg√∫n los cursos aprobados.
    </div>

    <div class="controls">
      <label>Cr√©ditos aprobados (auto) (obligatorios)
        <input id="creditosAprobados" type="number" min="0" max="250" step="1" value="0" readonly>
      </label>
      <label>Cr√©ditos aprobados (auto) (electivos)
        <input id="creditosElectivos" type="number" min="0" max="250" step="1" value="0" readonly>
      </label>
      <label>Nivel de ciclo (auto)
        <input id="nivelCulminado" type="number" min="0" max="10" step="1" value="1" readonly>
      </label>
      <div class="course-action-group">
        <button class="action-tile" onclick="simularCursos()">Simular cursos disponibles</button>
        <button class="action-tile" onclick="abrirHorario()">Armar horario</button>
      </div>
      <button onclick="limpiarCursos()">Limpiar selecci√≥n</button>
    </div>

    <div class="course-grid">
      <div class="course-section">
        <h3>‚úÖ Cursos aprobados</h3>
        <div id="courseChecklist"></div>
      </div>
      <div class="course-section course-results">
        <div>
          <h3>üìò Obligatorias disponibles</h3>
          <ul class="course-list" id="resultadoObligatorios"></ul>
          <div class="course-empty" id="emptyObligatorios" style="display:none;">
            A√∫n no hay cursos obligatorios disponibles con los requisitos actuales.
          </div>
        </div>
        <div>
          <h3>üéì Electivos disponibles</h3>
          <ul class="course-list" id="resultadoElectivos"></ul>
          <div class="course-empty" id="emptyElectivos" style="display:none;">
            A√∫n no hay cursos electivos disponibles con los requisitos actuales.
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="vistaHorario" style="display:none;">
    <div class="topbar">
      <div>
        <h2>Armar horario</h2>
        <div class="subtitle">Arrastra los cursos disponibles a tus gafetes por ciclo y edita el nombre de cada uno.</div>
        <div class="creator">Creador: Sebasti√°n Mory Ricse</div>
      </div>
      <div class="topbar-actions">
        <button class="btn-ghost btn-theme" onclick="toggleTheme()">üåô Dark mode</button>
        <button class="btn-secondary" onclick="volverCursos()">Volver a simulador</button>
      </div>
    </div>

    <div class="hint">
      Al mover cursos a un gafete, se consideran cursados y desbloquean nuevos cursos disponibles. Los requisitos, cr√©ditos y nivel se eval√∫an por ciclo: solo puedes colocar un curso si lo cumpliste[...]
    </div>

    <div class="schedule-grid">
      <div class="schedule-section">
        <h3>üìö Cursos disponibles</h3>
        <div class="schedule-list" id="scheduleCourseList"></div>
        <div class="course-empty" id="scheduleEmpty" style="display:none;">
          No hay cursos disponibles con los requisitos actuales.
        </div>
      </div>
      <div class="schedule-section">
        <div class="schedule-header">
          <h3>üóÇÔ∏è Gafetes por ciclo</h3>
          <div class="schedule-actions">
            <button class="btn-ghost" type="button" onclick="guardarGafetesPdf()">Guardar PDF</button>
            <button class="btn-primary" type="button" onclick="agregarGafete()">+ Agregar gafete</button>
          </div>
        </div>
        <div class="badge-grid" id="scheduleBadges"></div>
      </div>
    </div>
  </section>

</div>

<!-- MASCOTA: HTML agregado exactamente antes del <script> principal -->
<div id="mascota" aria-hidden="true">
  <div id="burbuja" role="status" aria-live="polite"></div>
</div>

<script>
  const APROBACION = 10.5;
  const tabla = document.getElementById("tabla");
  const canvas = document.getElementById("mathCanvas");
  const ctx = canvas.getContext("2d");
  const symbols = ["‚àë","œÄ","‚àö","Œî","‚à´","‚àû","+","‚àí","√ó","√∑","=","x","y","z","sin","cos","tan","log","‚àÇ","‚âà","‚â†","‚â§","‚â•","Œª","Œº","œÉ","œÜ","Œ≤","Œ∏","‚àá","1","2","3","4","5","[...placeholder...]"];
  const particles = [];
  const maxParticles = 90;
  const mouse = { x: -9999, y: -9999, active: false };

  function applyTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
    document.querySelectorAll(".btn-theme").forEach((btn) => {
      btn.textContent = (theme === "dark") ? "‚òÄÔ∏è Modo claro" : "üåô Dark mode";
    });
  }

  function toggleTheme(){
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    applyTheme(cur==="dark" ? "light" : "dark");
  }

  (function initTheme(){
    const saved = localStorage.getItem("theme");
    applyTheme(saved || "light");
  })();

  function resizeCanvas(){
    const rect = canvas.parentElement.getBoundingClientRect();
    const ratio = window.devicePixelRatio || 1;
    canvas.width = rect.width * ratio;
    canvas.height = rect.height * ratio;
    canvas.style.width = `${rect.width}px`;
    canvas.style.height = `${rect.height}px`;
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  }

  function createParticle(){
    const rect = canvas.getBoundingClientRect();
    return {
      x: Math.random() * rect.width,
      y: Math.random() * -rect.height,
      speed: 0.3 + Math.random() * 1.4,
      size: 10 + Math.random() * 14,
      symbol: symbols[Math.floor(Math.random() * symbols.length)],
      opacity: 0.15 + Math.random() * 0.6
    };
  }

  function updateParticles(){
    const rect = canvas.getBoundingClientRect();
    ctx.clearRect(0, 0, rect.width, rect.height);
    ctx.font = "14px system-ui, sans-serif";

    particles.forEach(p => {
      p.y += p.speed;
      const dx = p.x - mouse.x;
      const dy = p.y - mouse.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if(mouse.active && dist < 120){
        p.x += dx * 0.008;
        p.y += dy * 0.008;
      }
      if(p.y > rect.height + 20){
        p.y = -20;
        p.x = Math.random() * rect.width;
      }
      ctx.globalAlpha = p.opacity;
      ctx.fillText(p.symbol, p.x, p.y);
      ctx.globalAlpha = 1;
    });
  }

  /* (El resto del script original contin√∫a...) */
  /* ... (no modifiqu√© funciones existentes ni su posici√≥n) ... */

  /* -------------------------
     MASCOTA PIXEL (JS agregado)
     Se solicit√≥ colocar este JS justo antes del cierre </script>
     ------------------------- */
  (function(){
    // No tocar funciones existentes. Todo encapsulado aqu√≠.
    try {
      // Si el usuario ya apag√≥ la mascota, no inicializar.
      if (localStorage.getItem('mascota-off') === '1') return;

      const masc = document.getElementById('mascota');
      const burbuja = document.getElementById('burbuja');
      if (!masc || !burbuja) return;

      // Estado interno
      let x = parseFloat(localStorage.getItem('mascota-x')) || 20; // px
      let bottom = parseFloat(localStorage.getItem('mascota-bottom')) || 120; // px
      let speed = 0.7 + Math.random() * 0.8; // px per frame unit
      let dir = 1; // 1 derecha, -1 izquierda
      let sleeping = false;
      let docked = false; // si est√° "subido" a un bot√≥n
      let idleTimeout = null;
      const SLEEP_AFTER_MS = 8000; // 8 segundos
      const SAVE_EVERY_MS = 2000;
      let lastSave = Date.now();
      let lastMouseMove = Date.now();

      // Mensajes
      const msgs = [
        "¬°Hola!",
        "¬øListo para simular?",
        "¬°Buena suerte!",
        "No olvides guardar",
        "Casi listo...",
        "¬°√Ånimo!",
        "Zzz..."
      ];

      // Inicializar posici√≥n y estilos (solo lectura sobre capas existentes)
      function applyPos(){
        masc.style.left = Math.max(6, Math.min(window.innerWidth - 46, x)) + "px";
        masc.style.bottom = bottom + "px";
      }
      applyPos();

      // Guardar posici√≥n en localStorage peri√≥dicamente
      function savePos(){
        localStorage.setItem('mascota-x', Math.round(x));
        localStorage.setItem('mascota-bottom', Math.round(bottom));
      }

      // Animaci√≥n de andar
      function step(){
        if (!sleeping && !docked){
          x += dir * speed * (1 + Math.random() * 0.2) * 1.2;
          // bordes
          if (x < 6) { x = 6; dir = 1; }
          if (x > window.innerWidth - 46) { x = window.innerWidth - 46; dir = -1; }
          applyPos();
        }
        // Guardar peri√≥dicamente
        if (Date.now() - lastSave > SAVE_EVERY_MS){
          savePos();
          lastSave = Date.now();
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);

      // Mostrar burbuja con texto por un tiempo corto
      let bubbleTimer = null;
      function showBubble(text, ttl=1400){
        if (!text) return;
        burbuja.textContent = text;
        burbuja.classList.add('show');
        if (bubbleTimer) clearTimeout(bubbleTimer);
        bubbleTimer = setTimeout(() => {
          burbuja.classList.remove('show');
          bubbleTimer = null;
        }, ttl);
      }

      // Dormir/despertar
      function goSleep(){
        sleeping = true;
        masc.classList.add('dormido');
        showBubble("Zzz...", 3000);
      }
      function wakeUp(){
        if (sleeping){
          sleeping = false;
          masc.classList.remove('dormido');
          showBubble("¬°Hola!", 1200);
        }
      }
      function resetIdleTimer(){
        lastMouseMove = Date.now();
        if (idleTimeout) { clearTimeout(idleTimeout); idleTimeout = null; }
        idleTimeout = setTimeout(() => {
          // Si no hubo movimiento, dormir
          goSleep();
        }, SLEEP_AFTER_MS);
      }
      // iniciar contador
      resetIdleTimer();

      // React to global mouse movements (no pointer-events on mascot, so this doesn't block UI)
      window.addEventListener('mousemove', (ev) => {
        resetIdleTimer();
        // waking up on any move
        wakeUp();
        // show bubble when near mascot
        const mascRect = masc.getBoundingClientRect();
        const centerX = mascRect.left + mascRect.width/2;
        const centerY = mascRect.top + mascRect.height/2;
        const dx = ev.clientX - centerX;
        const dy = ev.clientY - centerY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < 90){
          // show a short message
          showBubble(msgs[Math.floor(Math.random()* (msgs.length-1))], 900);
        }
      }, { passive:true });

      // Listeners sobre botones: al pasar por un bot√≥n, la mascota se "sube" visualmente y se posiciona sobre √©l
      const buttons = Array.from(document.querySelectorAll('button, a[role="button"]'));
      const onEnter = (btn) => {
        return function(){
          try {
            const r = btn.getBoundingClientRect();
            const targetX = Math.max(6, Math.min(window.innerWidth - 46, r.left + (r.width/2) - 20));
            // "subirse"
            docked = true;
            masc.classList.add('subido');
            // mover masc above the button smoothly
            // compute bottom so it looks "on top" of button: distance from bottom of viewport
            const computedBottom = Math.max(56, window.innerHeight - r.top + 8);
            // apply movement
            masc.style.transition = "left 300ms ease, bottom 260ms ease, transform 180ms ease";
            x = targetX;
            bottom = computedBottom;
            applyPos();
            // mensaje
            showBubble("¬°Me subo!", 1000);
          } catch(e){ /* safe */ }
        };
      };
      const onLeave = (btn) => {
        return function(){
          // volver a caminar despu√©s de peque√±o delay
          masc.classList.remove('subido');
          masc.style.transition = "left 400ms ease, bottom 260ms ease, transform 180ms ease";
          // restablecer bottom al valor guardado (120 default)
          bottom = parseFloat(localStorage.getItem('mascota-bottom')) || 120;
          docked = false;
          showBubble("Bajando...", 900);
        };
      };

      buttons.forEach(b => {
        // add listeners, but do not modify button behavior
        b.addEventListener('mouseenter', onEnter(b), { passive:true });
        b.addEventListener('mouseleave', onLeave(b), { passive:true });
        // also when button gets focus via keyboard, we "subimos" (accessibility)
        b.addEventListener('focus', onEnter(b), { passive:true });
        b.addEventListener('blur', onLeave(b), { passive:true });
      });

      // Si el usuario hace click sobre un bot√≥n, la mascota hace un peque√±o salto de alegr√≠a (visual)
      buttons.forEach(b => {
        b.addEventListener('click', function(){
          // breve efecto visual
          masc.style.transition = "transform 140ms ease";
          masc.style.transform = "translateY(-10px)";
          setTimeout(() => {
            masc.style.transform = "";
          }, 160);
          // reset idle timer (actividad)
          resetIdleTimer();
        }, { passive:true });
      });

      // Guardar al salir de la p√°gina
      window.addEventListener('beforeunload', savePos, { passive:true });
      // Guardar tambi√©n peri√≥dicamente
      setInterval(savePos, SAVE_EVERY_MS);

      // Exponer funci√≥n para apagar la mascota desde consola o UI
      window.apagarMascota = function(){
        localStorage.setItem('mascota-off','1');
        try {
          masc.remove();
        } catch(e){}
      };
      // funci√≥n para encender si estaba apagada (manual)
      window.encenderMascota = function(){
        localStorage.removeItem('mascota-off');
        location.reload();
      };

      // Inicializar guardado inmediato
      savePos();

      // Reiniciar posici√≥n si se redimensiona (ajustar l√≠mites)
      window.addEventListener('resize', function(){
        x = Math.max(6, Math.min(window.innerWidth - 46, x));
        applyPos();
      }, { passive:true });

      // Opcional: t√©cnica para "acariciar" la mascota con click (sin bloquear)
      // detectamos clicks cerca de la mascota y mostramos mensaje amable
      window.addEventListener('click', function(ev){
        const mascRect = masc.getBoundingClientRect();
        const centerX = mascRect.left + mascRect.width/2;
        const centerY = mascRect.top + mascRect.height/2;
        const dx = ev.clientX - centerX;
        const dy = ev.clientY - centerY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < 70){
          showBubble("¬°Gracias!", 1100);
          resetIdleTimer();
          wakeUp();
        }
      }, { passive:true });

    } catch (err){
      // si algo falla en la inicializaci√≥n de la mascota, no romper el resto de la app
      console.error("Inicializando mascota: ", err);
    }
  })();

  /* Fin del c√≥digo de la mascota */
</script>
</body>
</html>
